{
    "collab_server" : "",
    "contents" : "library(bigrquery)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(knitr)\n\n######### FUNCION FECHA ###########\nfecha <- function(input_date){\n  year <- substr(input_date,1,4);\n  month <- substr(input_date,5,6);\n  day <- substr(input_date,7,8);\n  out_date <- paste(year,month,day,sep = \"-\")\n  return(out_date)}\n\n\n######### CONEXION BIGQUERY ###########\n# BigQuery project Id - NH\nBQ_PROJECT_ID <- \"useful-art-91609\";\n#BigQuery NH DataSet for Google Analytics Premium\n#BQ_DATASET_ID <- NH_pred;\n\n#Queries para las variables genericas\nquery_var_bool_est <- function(){\n  query <- paste(\"\n                 SELECT\n                 cookie_id_state,\n                 ROUND(MAX(frecuencia),2) as max,\n                 ROUND(MIN(frecuencia),2) as min,\n                 ROUND(AVG(frecuencia),2) as avg\n                 FROM(\n                 SELECT\n                 date,\n                 cookie_id_state,\n                 Count(cookie_id_state) as frecuencia,  \n                 FROM [useful-art-91609:NH_pred.Variable_boleana]\n                 GROUP BY 1,2)\n                 GROUP BY 1\n                 \")\n  data <- query_exec(query=query, project = BQ_PROJECT_ID,max_pages = Inf)\n  data\n}\nquery_bool_fecha <- function(){\n  query <- paste(\"SELECT \n                 date,\n                 cookie_id_state,\n                 Count(cookie_id)\n                 FROM [useful-art-91609:NH_pred.Variable_boleana]\n                 GROUP BY 1,2\n                 ORDER BY 1,2\n                 \")\n  data <- query_exec(query=query, project = BQ_PROJECT_ID,max_pages = Inf)\n  data\n}\nquery_bool_preview <- function(){\n  query <- paste(\"SELECT \n                  *\n                 FROM [useful-art-91609:NH_pred.Variable_boleana]\n                 order by cookie_id_fq desc\n                 limit 20\n                 \")\n  data <- query_exec(query=query, project = BQ_PROJECT_ID,max_pages = Inf)\n  data\n}\n\n\n######## ASIGNACION VARIABLES ######\nevol_b <- query_bool_fecha()\ntabla_bool_fecha <- query_var_bool_est()\n\n\nevol_b_total <- data.frame(5622447,2469400)\ncolnames(evol_b_total) <- c(\"New Cookie\", \"Returning Cookie\")\ncolnames(tabla_bool_fecha) <- c(\"Tipo de cookie\", \"Máximo\", \"Mínimo\", \"Promedio\")\ntabla_bool_preview <- query_bool_preview()\ntabla_bool_preview <- data.frame(tabla_bool_preview[,1],tabla_bool_preview[,2],tabla_bool_preview[,3])\ncolnames(tabla_bool_preview) <- c(\"Date\",\"Cookie_id\",\"Tipo de cookie\")\n\n#Evolucion\ncolnames(evol_b) <- c(\"date\",\"b_cookie_state\",\"count_cookie\");\n\nevol_b$dia <- as.integer(substr(evol_b$date,7,8));\nevol_b$annomes <- as.factor(as.integer(substr(evol_b$date,0,6)))\n\nevol_b_new_cookie <- subset(evol_b, evol_b$b_cookie_state==\"New cookie_id\")\nevol_b_ret_cookie <- subset(evol_b, evol_b$b_cookie_state==\"Returning cookie_id\")\nevol_b_final <- cbind(evol_b_new_cookie$count_cookie, evol_b_ret_cookie$count_cookie,evol_b_ret_cookie$dia,evol_b_new_cookie$annomes)\nevol_b_final <- cbind(evol_b_new_cookie, evol_b_ret_cookie)\nevol_b_final <- data.frame(evol_b_final[,3],evol_b_final[,8],evol_b_final[,9],evol_b_final[,10])\ncolnames(evol_b_final) <- c(\"New_cookie\", \"Returning_cookie\",\"dia\",\"annomes\") \nevol_b_final <- data.frame(evol_b_final)\ngr_evol <- ggplot(evol_b_final,aes(x = dia))\ngr_evol +  geom_line(aes(y = New_cookie), colour=\"red\") + geom_line(aes(y = Returning_cookie), colour=\"#003A70\") + facet_wrap(~annomes) + xlab(\"Día del mes\") + ylab(\"Número de cookies\") + ggtitle(\"Evolución tipo de cookie (Returning vs New)\")\n\n#S",
    "created" : 1486398418622.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3631431459",
    "id" : "32F9087E",
    "lastKnownWriteTime" : 1486398498,
    "last_content_update" : 1486398498087,
    "path" : "C:/Clientes/NH/Proyecto Modelo predictivo/Entregable HTML/NH_bool.r",
    "project_path" : "NH_bool.r",
    "properties" : {
        "source_window_id" : "wloje74pef9mb"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}